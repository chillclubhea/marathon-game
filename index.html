// 切換個人設定顯示/隱藏
    function toggleProfileEdit() {
        const setupCard = document.getElementById('setup-card');
        setupCard.classList.toggle('hidden');
    }

    async function showProfile(user) {
        document.getElementById('auth-section').classList.add('hidden');
        document.getElementById('profile-section').classList.remove('hidden');
        document.getElementById('user-display').innerText = `帳號: ${user.email}`;

        const { data } = await sb.from('profiles').select('*').eq('id', user.id).single();
        
        if (data) {
            // 填入既有資料
            document.getElementById('full_name').value = data.full_name || '';
            document.getElementById('role').value = data.role || 'member';
            document.getElementById('plan').value = data.plan || 'slow';
            document.getElementById('team_id_input').value = data.current_team_id || '';
            if (data.avatar_url) document.getElementById('avatar-img').src = data.avatar_url;

            // --- 關鍵邏輯：判斷是否為「老學員」 ---
            // 如果姓名跟隊伍 ID 都填過了，就隱藏設定卡片，顯示修改按鈕
            if (data.full_name && data.current_team_id) {
                document.getElementById('setup-card').classList.add('hidden');
                document.getElementById('edit-profile-btn').classList.remove('hidden');
            }
        }
    }

    // 在 updateProfile 成功後，記得讓頁面重新整理或重新判斷
    async function updateProfile() {
        // ... 原本的圖片上傳與 upsert 邏輯 ...
        
        // 修改最後的 alert 之後
        if (error) alert(error.message); 
        else { 
            alert("設定已儲存！"); 
            location.reload(); // 重新整理會觸發 showProfile 重新判斷隱藏狀態
        }
    }
