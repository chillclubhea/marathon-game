<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦¬æ‹‰æ¾å¥èº«è¿½è¹¤</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --gray-color: #95a5a6;
            --card-bg: #ffffff;
            --bg-color: #f8f9fa;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft JhengHei', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--dark-color);
            line-height: 1.5;
            padding: 16px;
            max-width: 800px;
            margin: 0 auto;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* ç™»å…¥é é¢æ¨£å¼ */
        .auth-section {
            max-width: 400px;
            margin: 40px auto;
        }
        
        .auth-card {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 30px 25px;
            box-shadow: var(--shadow);
            border-top: 6px solid var(--primary-color);
        }
        
        .auth-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--dark-color);
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 1rem;
            transition: border 0.3s;
            background-color: white;
        }
        
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .auth-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }
        
        .auth-buttons button {
            padding: 16px;
            font-weight: 700;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-color), #27ae60);
            color: white;
        }
        
        .btn-secondary:active {
            transform: scale(0.98);
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--gray-color);
            font-size: 0.9rem;
        }
        
        /* ä¸»æ‡‰ç”¨é é¢æ¨£å¼ */
        #app-section {
            display: none;
        }
        
        .app-section.show {
            display: block;
        }
        
        /* é ‚éƒ¨å°èˆªæ¬„ - å„ªåŒ–ä½ˆå±€ */
        .top-nav {
            margin-bottom: 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--bg-color);
            padding-top: 8px;
            padding-bottom: 8px;
        }
        
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            gap: 15px;
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-color);
            flex: 1;
        }
        
        .app-logo i {
            font-size: 1.6rem;
        }
        
        /* ç”¨æˆ¶å€åŸŸ - åˆ†é–‹é ­åƒå’Œç©åˆ† */
        .user-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* ä»Šæ—¥å¤©æ•¸å¾½ç«  */
        .day-badge {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            border-radius: 16px;
            padding: 8px 15px;
            font-size: 0.9rem;
            font-weight: 700;
            min-width: 80px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .day-badge i {
            font-size: 0.9rem;
        }
        
        /* ç”¨æˆ¶é ­åƒæŒ‰éˆ• - åŒ…å«ä¸‹æ‹‰èœå–® */
        .user-avatar-container {
            position: relative;
            cursor: pointer;
        }
        
        .user-avatar-btn {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            border: 3px solid white;
            box-shadow: var(--shadow);
            position: relative;
        }
        
        /* ç”¨æˆ¶ä¸‹æ‹‰èœå–® */
        .user-menu-dropdown {
            position: absolute;
            top: 65px;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            min-width: 200px;
            padding: 10px;
            z-index: 1000;
            display: none;
        }
        
        .user-menu-dropdown.show {
            display: block;
        }
        
        .user-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .user-menu-item:hover {
            background: #f5f7fa;
        }
        
        .user-menu-item i {
            color: var(--primary-color);
            width: 20px;
        }
        
        /* æ­¡è¿è¨Šæ¯ */
        .nav-subheader {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .welcome-message {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .deadline-countdown {
            background-color: var(--accent-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            align-self: flex-start;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }
        
        .countdown-timer {
            font-weight: 700;
            font-size: 0.95rem;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5px;
        }
        
        /* æ¯æ—¥æ•¸æ“šå ±åˆ°å¡ç‰‡ */
        .daily-checkin-card {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 24px 20px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            border-top: 6px solid var(--secondary-color);
            position: relative;
            overflow: hidden;
        }
        
        .card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--dark-color);
            padding-bottom: 16px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .card-title i {
            color: var(--primary-color);
        }
        
        /* è¼¸å…¥å®¹å™¨ - ä¸‰å€‹æ•¸æ“šæ©«å‘æ’åˆ— */
        .input-container {
            display: flex;
            flex-direction: row;
            gap: 12px;
            margin-top: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: none;
            -ms-overflow-style: none;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            padding-left: 10px;
            padding-right: 10px;
        }
        
        .input-container::-webkit-scrollbar {
            display: none;
        }
        
        /* è¼¸å…¥æ¡† */
        .input-box {
            flex: 0 0 auto;
            width: 280px;
            scroll-snap-align: start;
            text-align: center;
            padding: 20px 15px;
            border-radius: 16px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2.5px solid #e9ecef;
            transition: all 0.25s ease;
            position: relative;
            touch-action: manipulation;
            user-select: none;
        }
        
        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 640px) {
            .input-box {
                width: calc(100vw - 60px);
                min-width: calc(100vw - 60px);
                margin: 0 5px;
            }
            
            .nav-header {
                flex-wrap: wrap;
            }
            
            .user-area {
                order: 3;
                width: 100%;
                justify-content: space-between;
                margin-top: 10px;
            }
        }
        
        @media (min-width: 641px) and (max-width: 800px) {
            .input-box {
                width: calc(33.333% - 16px);
                min-width: calc(33.333% - 16px);
            }
        }
        
        @media (min-width: 801px) {
            .input-box {
                width: calc(33.333% - 16px);
                min-width: 220px;
            }
        }
        
        .input-box.locked {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            border-color: #ced4da;
            opacity: 0.8;
        }
        
        /* å€¼é¡¯ç¤ºå€åŸŸ */
        .value-display {
            width: 100%;
            font-size: 2.6rem;
            font-weight: 800;
            text-align: center;
            border: none;
            background: transparent;
            color: var(--dark-color);
            outline: none;
            padding: 8px 5px;
            pointer-events: none;
            user-select: none;
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
            line-height: 1;
            margin-bottom: 5px;
        }
        
        /* è¼¸å…¥æ§åˆ¶æŒ‰éˆ• */
        .input-controls {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 20px;
            margin-bottom: 15px;
        }
        
        .control-btn {
            width: 56px;
            height: 56px;
            min-width: 56px;
            min-height: 56px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary-color);
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            touch-action: manipulation;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.2);
        }
        
        .control-btn:active {
            background: var(--primary-color);
            color: white;
            transform: scale(0.92);
            box-shadow: 0 2px 5px rgba(52, 152, 219, 0.3);
        }
        
        /* æ¨™ç±¤æ¨£å¼ */
        .data-label {
            font-size: 1.05rem;
            color: var(--dark-color);
            margin-top: 8px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .data-unit {
            font-size: 0.95rem;
            color: var(--gray-color);
            font-weight: 600;
        }
        
        /* æ»‘å‹•æŒ‡ç¤ºå™¨ */
        .swipe-indicator {
            text-align: center;
            margin-top: 12px;
            color: var(--gray-color);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        /* è§¸æ§æç¤º */
        .touch-hint {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: var(--primary-color);
            font-size: 0.9rem;
            margin-top: 16px;
            font-weight: 600;
            opacity: 0.8;
        }
        
        /* æŒ‰éˆ•å€åŸŸ */
        .button-section {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 28px;
            flex-wrap: wrap;
        }
        
        .submit-btn {
            padding: 18px 36px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, var(--secondary-color), #27ae60);
            color: white;
            border-radius: 60px;
            border: none;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.35);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            touch-action: manipulation;
        }
        
        .submit-btn:active:not(:disabled) {
            transform: scale(0.96);
            box-shadow: 0 3px 12px rgba(46, 204, 113, 0.4);
        }
        
        .submit-btn:disabled {
            background: linear-gradient(135deg, #bdc3c7, #95a5a6);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 12px rgba(189, 195, 199, 0.3);
        }
        
        /* éœ‡å‹•åé¥‹æ¨¡æ“¬ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }
        
        .shake {
            animation: shake 0.3s ease;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* ç‹€æ…‹è¨Šæ¯ */
        .status-msg {
            text-align: center;
            margin-top: 20px;
            font-size: 1rem;
            min-height: 26px;
            padding: 14px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .status-msg.success {
            background-color: rgba(46, 204, 113, 0.15);
            color: var(--secondary-color);
            border: 2px solid rgba(46, 204, 113, 0.25);
        }
        
        .status-msg.error {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--accent-color);
            border: 2px solid rgba(231, 76, 60, 0.25);
        }
        
        .status-msg.warning {
            background-color: rgba(241, 196, 15, 0.15);
            color: #f39c12;
            border: 2px solid rgba(241, 196, 15, 0.25);
        }
        
        /* ç™»å‡ºæŒ‰éˆ• */
        .logout-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent-color), #c0392b);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
        }
        
        .logout-btn:active {
            transform: scale(0.95);
        }
        
        /* å€‹äººè¨­å®šæ¨¡æ…‹æ¡† */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 25px;
            width: 90%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.3rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
            padding: 5px;
        }
        
        .close-modal:hover {
            color: var(--accent-color);
        }
        
        /* é ­åƒé è¦½ */
        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary-color);
            margin: 0 auto 20px;
            display: block;
        }
        
        /* è¡Œå…§è¡¨å–® */
        .row {
            display: flex;
            gap: 15px;
        }
        
        .row .form-group {
            flex: 1;
        }
        
        /* éŒ¯èª¤è¨Šæ¯ */
        .error-message {
            color: var(--accent-color);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        /* å¤–éƒ¨é€£çµæ¨£å¼ */
        .external-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }
    </style>
</head>
<body>
    <!-- ç™»å…¥é é¢ï¼ˆåˆå§‹é¡¯ç¤ºï¼‰ -->
    <div id="auth-section" class="auth-section">
        <div class="auth-card">
            <h2 class="auth-title">
                <i class="fas fa-running"></i>
                é¦¬æ‹‰æ¾å¥èº«è¿½è¹¤
            </h2>
            
            <div class="form-group">
                <label for="email">é›»å­éƒµä»¶</label>
                <input type="email" id="email" placeholder="è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶">
                <div class="error-message" id="email-error"></div>
            </div>
            
            <div class="form-group">
                <label for="password">å¯†ç¢¼</label>
                <input type="password" id="password" placeholder="è¼¸å…¥å¯†ç¢¼">
                <div class="error-message" id="password-error"></div>
            </div>
            
            <div class="auth-buttons">
                <button class="btn-primary" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    ç™»å…¥
                </button>
                <button class="btn-secondary" id="signup-btn">
                    <i class="fas fa-user-plus"></i>
                    è¨»å†Šæ–°å¸³è™Ÿ
                </button>
            </div>
            
            <div class="auth-footer">
                <p>ç™»å…¥å¾Œå¯è¿½è¹¤å¥èº«é€²åº¦</p>
            </div>
        </div>
    </div>
    
    <!-- ä¸»æ‡‰ç”¨é é¢ï¼ˆåˆå§‹éš±è—ï¼‰ -->
    <div id="app-section" class="app-section">
        <!-- é ‚éƒ¨å°èˆªæ¬„ -->
        <div class="top-nav">
            <div class="nav-header">
                <div class="app-logo">
                    <i class="fas fa-running"></i>
                    <span>é¦¬æ‹‰æ¾å¥èº«è¿½è¹¤</span>
                </div>
                
                <div class="user-area">
                    <!-- ä»Šæ—¥å¤©æ•¸å¾½ç«  -->
                    <div class="day-badge" id="day-badge">
                        <i class="fas fa-calendar-day"></i>
                        <span id="current-day">Day 1</span>
                    </div>
                    
                    <!-- ç”¨æˆ¶é ­åƒå’Œä¸‹æ‹‰èœå–® -->
                    <div class="user-avatar-container">
                        <div class="user-avatar-btn" id="user-avatar-btn">
                            <i class="fas fa-user"></i>
                        </div>
                        
                        <!-- ç”¨æˆ¶ä¸‹æ‹‰èœå–® -->
                        <div class="user-menu-dropdown" id="user-menu-dropdown">
                            <div class="user-menu-item" id="personal-settings-btn">
                                <i class="fas fa-user-cog"></i>
                                <span>å€‹äººè¨­å®š</span>
                            </div>
                            <a href="https://marathon-game.vercel.app/team.html" target="_blank" class="external-link">
                                <div class="user-menu-item">
                                    <i class="fas fa-trophy"></i>
                                    <span>ğŸ† é¦¬æ‹‰æ¾æˆ°éšŠé€²åº¦</span>
                                </div>
                            </a>
                            <a href="https://marathon-game.vercel.app/leaderboard.html" target="_blank" class="external-link">
                                <div class="user-menu-item">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>æ’è¡Œæ¦œ</span>
                                </div>
                            </a>
                            <div class="user-menu-item" id="points-rules-btn">
                                <i class="fas fa-star"></i>
                                <span>ç©åˆ†è¦å‰‡</span>
                            </div>
                            <div class="user-menu-item" id="schedule-btn">
                                <i class="fas fa-calendar-alt"></i>
                                <span>æ¯ä¸€å±†æ™‚é–“è¡¨</span>
                            </div>
                            <div class="user-menu-item" id="logout-menu-btn">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>ç™»å‡º</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="nav-subheader">
                <div class="welcome-message" id="welcome-message">æ­¡è¿å›ä¾†</div>
                <div class="deadline-countdown">
                    <i class="fas fa-clock"></i>
                    ä»Šæ—¥å ±åˆ°æˆªæ­¢: <span class="countdown-timer" id="countdown-timer">01:04:41</span>
                </div>
            </div>
        </div>
        
        <!-- æ¯æ—¥æ•¸æ“šå ±åˆ°å¡ç‰‡ -->
        <div class="daily-checkin-card">
            <h2 class="card-title">
                <i class="fas fa-calendar-day"></i> æ¯æ—¥æ•¸æ“šå ±åˆ°
            </h2>
            <p class="input-hint">
                è«‹è¼¸å…¥ä»Šæ—¥çš„æ•¸æ“šï¼Œå¯é»æ“ŠåŠ æ¸›æŒ‰éˆ•èª¿æ•´ï¼Œæˆ–ç›´æ¥æ»‘å‹•æ•¸æ“šå€åŸŸèª¿æ•´
            </p>
            
            <!-- ä¸‰å€‹æ•¸æ“šæ©«å‘æ’åˆ— -->
            <div class="input-container" id="input-container">
                <!-- é«”é‡è¼¸å…¥ -->
                <div class="input-box" id="weight-box" data-type="weight">
                    <input type="text" class="value-display" id="weight-value" value="65.3" readonly>
                    <div class="input-controls">
                        <button class="control-btn minus-btn" data-type="weight" data-change="-0.1">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="control-btn plus-btn" data-type="weight" data-change="0.1">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="data-label">é«”é‡ <span class="data-unit">kg</span></div>
                </div>
                
                <!-- é«”è„‚ç‡è¼¸å…¥ -->
                <div class="input-box" id="fat-box" data-type="fat">
                    <input type="text" class="value-display" id="fat-value" value="41.3" readonly>
                    <div class="input-controls">
                        <button class="control-btn minus-btn" data-type="fat" data-change="-0.1">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="control-btn plus-btn" data-type="fat" data-change="0.1">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="data-label">é«”è„‚ç‡ <span class="data-unit">%</span></div>
                </div>
                
                <!-- è‚Œè‚‰é‡è¼¸å…¥ -->
                <div class="input-box" id="muscle-box" data-type="muscle">
                    <input type="text" class="value-display" id="muscle-value" value="20.1" readonly>
                    <div class="input-controls">
                        <button class="control-btn minus-btn" data-type="muscle" data-change="-0.1">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="control-btn plus-btn" data-type="muscle" data-change="0.1">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="data-label">è‚Œè‚‰é‡ <span class="data-unit">kg</span></div>
                </div>
            </div>
            
            <!-- æ»‘å‹•æç¤º -->
            <div class="swipe-indicator">
                <i class="fas fa-arrows-left-right"></i>
                <span>æ»‘å‹•æŸ¥çœ‹æ‰€æœ‰æ•¸æ“š</span>
            </div>
            
            <!-- è§¸æ§æç¤º -->
            <div class="touch-hint">
                <i class="fas fa-hand-point-up"></i>
                <span>é•·æŒ‰æŒ‰éˆ•å¯å¿«é€Ÿèª¿æ•´</span>
            </div>
            
            <!-- æŒ‰éˆ•å€åŸŸ -->
            <div class="button-section">
                <button class="submit-btn" id="submitBtn">
                    <i class="fas fa-paper-plane"></i> é€å‡ºä»Šæ—¥å ±åˆ°
                </button>
            </div>
            
            <!-- ç‹€æ…‹è¨Šæ¯ -->
            <div class="status-msg" id="status-msg"></div>
        </div>
        
        <!-- åº•éƒ¨ç™»å‡ºæŒ‰éˆ• -->
        <button class="logout-btn" id="logout-btn">
            <i class="fas fa-sign-out-alt"></i> ç™»å‡º
        </button>
    </div>
    
    <!-- å€‹äººè¨­å®šæ¨¡æ…‹æ¡† -->
    <div class="modal-overlay" id="personal-settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user-cog"></i>
                    ğŸ‘¤ å€‹äººè¨­å®š & åŠ å…¥éšŠä¼
                </h3>
                <button class="close-modal" id="close-settings-modal">&times;</button>
            </div>
            
            <img id="avatar-img" class="avatar-preview" src="https://ui-avatars.com/api/?name=User&background=random&size=100">
            
            <div class="form-group">
                <label>æ›´æ›é ­åƒ</label>
                <input type="file" id="avatar_file" accept="image/*">
            </div>
            
            <div class="form-group">
                <label>çœŸå¯¦å§“å</label>
                <input type="text" id="full_name" placeholder="éšŠå‹å¦‚ä½•ç¨±å‘¼ä½ ">
            </div>
            
            <div class="row">
                <div class="form-group">
                    <label>è§’è‰²</label>
                    <select id="role">
                        <option value="member">å­¸å“¡</option>
                        <option value="captain">éšŠé•·</option>
                        <option value="deputy">å‰¯éšŠé•·</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è¨ˆç•«</label>
                    <select id="plan">
                        <option value="slow_run">æ…¢è·‘</option>
                        <option value="fast_run">å¿«è·‘</option>
                        <option value="vip">VIP</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                <label>åŠ å…¥éšŠä¼é‚€è«‹ç¢¼ (Team ID)</label>
                <input type="text" id="team_id_input" placeholder="è²¼ä¸ŠéšŠé•·çµ¦çš„ ID">
                <small style="color:#666; display:block; margin-top:5px;">è‹¥ç„¡éšŠä¼ä»£ç¢¼ï¼Œè«‹è¯çµ¡éšŠé•·</small>
            </div>
            
            <div class="auth-buttons" style="margin-top: 20px;">
                <button class="btn-primary" id="save-profile-btn">
                    <i class="fas fa-save"></i>
                    å„²å­˜è¨­å®š
                </button>
            </div>
        </div>
    </div>

    <script>
        // ä½¿ç”¨ç«‹å³åŸ·è¡Œå‡½æ•¸ä¾†é¿å…è®Šæ•¸é‡è¤‡è²æ˜
        (function() {
            // Supabaseé…ç½®
            const SUPABASE_URL = 'https://your-project.supabase.co'; // è«‹æ›¿æ›ç‚ºæ‚¨çš„Supabase URL
            const SUPABASE_ANON_KEY = 'your-anon-key'; // è«‹æ›¿æ›ç‚ºæ‚¨çš„SupabaseåŒ¿åå¯†é‘°
            
            // åˆå§‹åŒ–Supabase - åªè²æ˜ä¸€æ¬¡
            let supabaseClient = null;
            try {
                if (window.supabase) {
                    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log('Supabaseå®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ');
                }
            } catch (error) {
                console.error('Supabaseåˆå§‹åŒ–å¤±æ•—:', error);
            }
            
            // èªè­‰ç®¡ç†
            class AuthManager {
                constructor() {
                    this.currentUser = null;
                    this.authKey = 'marathon_auth_token';
                    this.userProfileKey = 'marathon_user_profile';
                    this.init();
                }
                
                init() {
                    this.checkAuth();
                }
                
                // æª¢æŸ¥èªè­‰ç‹€æ…‹
                checkAuth() {
                    const token = localStorage.getItem(this.authKey);
                    const userData = localStorage.getItem('currentUser');
                    
                    if (token && userData) {
                        try {
                            this.currentUser = JSON.parse(userData);
                            // é©—è­‰tokenæ˜¯å¦æœ‰æ•ˆï¼ˆç°¡å–®æª¢æŸ¥ï¼‰
                            if (this.currentUser.token === token) {
                                return true;
                            }
                        } catch (e) {
                            console.error('è§£æä½¿ç”¨è€…æ•¸æ“šéŒ¯èª¤:', e);
                        }
                    }
                    
                    return false;
                }
                
                // è¨ˆç®—ç•¶å‰æ˜¯ç¬¬å¹¾å¤© - åŸºæ–¼ä½¿ç”¨è€…é–‹å§‹æ—¥æœŸ
                getCurrentDay() {
                    // å˜—è©¦å¾localStorageç²å–ä½¿ç”¨è€…çš„é–‹å§‹æ—¥æœŸ
                    const startDateStr = localStorage.getItem('user_start_date');
                    
                    if (startDateStr) {
                        // å¦‚æœæœ‰å„²å­˜çš„é–‹å§‹æ—¥æœŸï¼Œä½¿ç”¨è©²æ—¥æœŸè¨ˆç®—
                        const startDate = new Date(startDateStr);
                        const today = new Date();
                        
                        // ç¢ºä¿æ™‚é–“è¨­ç½®æ­£ç¢º
                        startDate.setHours(0, 0, 0, 0);
                        today.setHours(0, 0, 0, 0);
                        
                        const timeDiff = today.getTime() - startDate.getTime();
                        const dayDiff = Math.floor(timeDiff / (1000 * 3600 * 24)) + 1; // +1 å› ç‚ºç¬¬ä¸€å¤©æ˜¯Day 1
                        
                        console.log(`é–‹å§‹æ—¥æœŸ: ${startDateStr}, ä»Šå¤©: ${today.toISOString().split('T')[0]}, å¤©æ•¸å·®: ${dayDiff}`);
                        return Math.max(1, dayDiff); // ç¢ºä¿ä¸æœƒå°æ–¼1
                    } else {
                        // å¦‚æœæ²’æœ‰å„²å­˜çš„é–‹å§‹æ—¥æœŸï¼Œè¨­å®šä»Šå¤©ç‚ºç¬¬4å¤©
                        const today = new Date();
                        // å°‡é–‹å§‹æ—¥æœŸè¨­å®šç‚º3å¤©å‰ï¼ˆå› ç‚ºä»Šå¤©æ˜¯ç¬¬4å¤©ï¼‰
                        const startDate = new Date(today);
                        startDate.setDate(today.getDate() - 3);
                        
                        localStorage.setItem('user_start_date', startDate.toISOString().split('T')[0]);
                        console.log(`æ–°ä½¿ç”¨è€…ï¼Œè¨­å®šé–‹å§‹æ—¥æœŸç‚º: ${startDate.toISOString().split('T')[0]}, ä»Šå¤©æ˜¯ç¬¬4å¤©`);
                        return 4;
                    }
                }
                
                // ç°¡æ˜“ç™»å…¥ç³»çµ±ï¼ˆå¦‚æœSupabaseæœªè¨­ç½®ï¼‰
                async simpleLogin(email, password) {
                    // é©—è­‰è¼¸å…¥
                    if (!email || !password) {
                        throw new Error('è«‹è¼¸å…¥é›»å­éƒµä»¶å’Œå¯†ç¢¼');
                    }
                    
                    if (!this.validateEmail(email)) {
                        throw new Error('è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶');
                    }
                    
                    if (password.length < 6) {
                        throw new Error('å¯†ç¢¼å¿…é ˆè‡³å°‘6å€‹å­—ç¬¦');
                    }
                    
                    // å‰µå»ºæœ¬åœ°ç”¨æˆ¶
                    this.currentUser = {
                        id: 'user_' + Date.now(),
                        email: email,
                        name: email.split('@')[0],
                        token: this.generateToken()
                    };
                    
                    // å„²å­˜åˆ°localStorage
                    localStorage.setItem(this.authKey, this.currentUser.token);
                    localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                    
                    return this.currentUser;
                }
                
                // ç™»å…¥
                async login(email, password) {
                    try {
                        // å…ˆå˜—è©¦Supabaseç™»å…¥
                        if (supabaseClient) {
                            return await this.supabaseLogin(email, password);
                        }
                    } catch (supabaseError) {
                        console.log('Supabaseç™»å…¥å¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼:', supabaseError);
                    }
                    
                    // å¦‚æœSupabaseå¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼
                    return await this.simpleLogin(email, password);
                }
                
                // Supabaseç™»å…¥
                async supabaseLogin(email, password) {
                    if (!supabaseClient) {
                        throw new Error('Supabaseæœªæ­£ç¢ºé…ç½®');
                    }
                    
                    try {
                        // ä½¿ç”¨Supabase Authé€²è¡Œç™»å…¥
                        const { data, error } = await supabaseClient.auth.signInWithPassword({
                            email: email,
                            password: password
                        });
                        
                        if (error) {
                            // å¦‚æœä½¿ç”¨è€…ä¸å­˜åœ¨ï¼Œå˜—è©¦è¨»å†Š
                            if (error.message.includes('Invalid login credentials')) {
                                const { data: signupData, error: signupError } = await supabaseClient.auth.signUp({
                                    email: email,
                                    password: password
                                });
                                
                                if (signupError) throw signupError;
                                
                                // å‰µå»ºä½¿ç”¨è€…è³‡æ–™
                                const { error: profileError } = await supabaseClient
                                    .from('users')
                                    .insert([
                                        {
                                            id: signupData.user.id,
                                            email: email,
                                            name: email.split('@')[0],
                                            created_at: new Date().toISOString()
                                        }
                                    ]);
                                
                                if (profileError) {
                                    console.error('å‰µå»ºä½¿ç”¨è€…è³‡æ–™éŒ¯èª¤:', profileError);
                                }
                                
                                this.currentUser = {
                                    id: signupData.user.id,
                                    email: signupData.user.email,
                                    name: email.split('@')[0],
                                    token: signupData.session.access_token
                                };
                            } else {
                                throw error;
                            }
                        } else {
                            // ç™»å…¥æˆåŠŸ
                            this.currentUser = {
                                id: data.user.id,
                                email: data.user.email,
                                name: data.user.user_metadata?.name || email.split('@')[0],
                                token: data.session.access_token
                            };
                        }
                        
                        // å„²å­˜åˆ°localStorage
                        localStorage.setItem(this.authKey, this.currentUser.token);
                        localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                        
                        return this.currentUser;
                        
                    } catch (error) {
                        console.error('Supabaseç™»å…¥éŒ¯èª¤:', error);
                        throw error;
                    }
                }
                
                // è¨»å†Š
                async signup(email, password) {
                    return await this.login(email, password); // ç°¡åŒ–è™•ç†ï¼Œèˆ‡ç™»å…¥ç›¸åŒ
                }
                
                // ç™»å‡º
                logout() {
                    this.currentUser = null;
                    localStorage.removeItem(this.authKey);
                    localStorage.removeItem('currentUser');
                    
                    // å˜—è©¦Supabaseç™»å‡º
                    if (supabaseClient) {
                        supabaseClient.auth.signOut().catch(error => {
                            console.error('Supabaseç™»å‡ºéŒ¯èª¤:', error);
                        });
                    }
                    
                    return true;
                }
                
                // ç”¢ç”Ÿtoken
                generateToken() {
                    return 'token_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                }
                
                // é©—è­‰emailæ ¼å¼
                validateEmail(email) {
                    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return re.test(email);
                }
                
                // ç²å–ç•¶å‰ä½¿ç”¨è€…
                getUser() {
                    return this.currentUser;
                }
                
                // å„²å­˜ä½¿ç”¨è€…è¨­å®š
                saveUserProfile(profile) {
                    localStorage.setItem(this.userProfileKey, JSON.stringify(profile));
                    return true;
                }
                
                // è¼‰å…¥ä½¿ç”¨è€…è¨­å®š
                loadUserProfile() {
                    const profileStr = localStorage.getItem(this.userProfileKey);
                    if (profileStr) {
                        try {
                            return JSON.parse(profileStr);
                        } catch (e) {
                            console.error('è§£æä½¿ç”¨è€…è¨­å®šéŒ¯èª¤:', e);
                        }
                    }
                    return null;
                }
                
                // æ›´æ–°ä½¿ç”¨è€…è³‡æ–™
                updateUser(userData) {
                    if (this.currentUser) {
                        this.currentUser = { ...this.currentUser, ...userData };
                        localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                        return true;
                    }
                    return false;
                }
            }
            
            // DOMå…ƒç´ 
            const authSection = document.getElementById('auth-section');
            const appSection = document.getElementById('app-section');
            const weightValue = document.getElementById('weight-value');
            const fatValue = document.getElementById('fat-value');
            const muscleValue = document.getElementById('muscle-value');
            const submitBtn = document.getElementById('submitBtn');
            const statusMsg = document.getElementById('status-msg');
            const welcomeMessage = document.getElementById('welcome-message');
            const countdownTimer = document.getElementById('countdown-timer');
            const currentDay = document.getElementById('current-day');
            const userAvatarBtn = document.getElementById('user-avatar-btn');
            const userMenuDropdown = document.getElementById('user-menu-dropdown');
            const emailError = document.getElementById('email-error');
            const passwordError = document.getElementById('password-error');
            
            // æ¨¡æ…‹æ¡†å…ƒç´ 
            const personalSettingsModal = document.getElementById('personal-settings-modal');
            const closeSettingsModal = document.getElementById('close-settings-modal');
            const saveProfileBtn = document.getElementById('save-profile-btn');
            const avatarImg = document.getElementById('avatar-img');
            const avatarFile = document.getElementById('avatar_file');
            const fullNameInput = document.getElementById('full_name');
            const roleSelect = document.getElementById('role');
            const planSelect = document.getElementById('plan');
            const teamIdInput = document.getElementById('team_id_input');
            
            // æŒ‰éˆ•å…ƒç´ 
            const loginBtn = document.getElementById('login-btn');
            const signupBtn = document.getElementById('signup-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const personalSettingsBtn = document.getElementById('personal-settings-btn');
            const pointsRulesBtn = document.getElementById('points-rules-btn');
            const scheduleBtn = document.getElementById('schedule-btn');
            const logoutMenuBtn = document.getElementById('logout-menu-btn');
            
            // åˆå§‹åŒ–èªè­‰ç®¡ç†
            const authManager = new AuthManager();
            
            // é é¢ç‹€æ…‹
            let isSubmitted = false;
            let countdownInterval = null;
            
            // åˆå§‹åŒ–é é¢
            document.addEventListener('DOMContentLoaded', function() {
                // æª¢æŸ¥ç™»å…¥ç‹€æ…‹ä¸¦å°å‘æ­£ç¢ºé é¢
                checkAndRedirect();
                
                // è¨­å®šäº‹ä»¶ç›£è½å™¨
                setupEventListeners();
                
                // è¼‰å…¥ä½¿ç”¨è€…è¨­å®š
                loadUserProfile();
            });
            
            // æª¢æŸ¥ä¸¦å°å‘é é¢
            async function checkAndRedirect() {
                const isAuthenticated = authManager.checkAuth();
                
                if (isAuthenticated) {
                    await showAppSection();
                } else {
                    showAuthSection();
                }
            }
            
            // é¡¯ç¤ºç™»å…¥é é¢
            function showAuthSection() {
                authSection.style.display = 'block';
                appSection.style.display = 'none';
                
                // æ¸…é™¤å€’æ•¸è¨ˆæ™‚
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                }
                
                // æ¸…é™¤éŒ¯èª¤è¨Šæ¯
                clearErrors();
            }
            
            // é¡¯ç¤ºä¸»æ‡‰ç”¨é é¢
            async function showAppSection() {
                authSection.style.display = 'none';
                appSection.style.display = 'block';
                
                // æ›´æ–°ä½¿ç”¨è€…è³‡è¨Š
                const user = authManager.getUser();
                if (user) {
                    welcomeMessage.textContent = `æ­¡è¿ï¼Œ${user.name}`;
                    submitBtn.disabled = false;
                    
                    // æ›´æ–°ä»Šæ—¥å¤©æ•¸
                    const day = authManager.getCurrentDay();
                    currentDay.textContent = `Day ${day}`;
                }
                
                // å•Ÿå‹•å€’æ•¸è¨ˆæ™‚
                updateCountdown();
                countdownInterval = setInterval(updateCountdown, 1000);
                
                // æª¢æŸ¥ä»Šå¤©æ˜¯å¦å·²æäº¤
                await checkTodaySubmission();
                
                // è¼‰å…¥ä¸Šæ¬¡æ•¸æ“š
                await loadLastData();
            }
            
            // æ¸…é™¤éŒ¯èª¤è¨Šæ¯
            function clearErrors() {
                emailError.textContent = '';
                emailError.classList.remove('show');
                passwordError.textContent = '';
                passwordError.classList.remove('show');
            }
            
            // è¼‰å…¥ä½¿ç”¨è€…è¨­å®š
            function loadUserProfile() {
                const profile = authManager.loadUserProfile();
                if (profile) {
                    // æ›´æ–°æ¨¡æ…‹æ¡†ä¸­çš„è¡¨å–®
                    if (profile.fullName) fullNameInput.value = profile.fullName;
                    if (profile.role) roleSelect.value = profile.role;
                    if (profile.plan) planSelect.value = profile.plan;
                    if (profile.teamId) teamIdInput.value = profile.teamId;
                    if (profile.avatarUrl) avatarImg.src = profile.avatarUrl;
                    
                    // æ›´æ–°ä½¿ç”¨è€…åç¨±é¡¯ç¤º
                    const user = authManager.getUser();
                    if (user && profile.fullName) {
                        user.name = profile.fullName;
                        authManager.updateUser(user);
                        welcomeMessage.textContent = `æ­¡è¿ï¼Œ${profile.fullName}`;
                    }
                }
            }
            
            // è¼‰å…¥ä¸Šæ¬¡æ•¸æ“š
            async function loadLastData() {
                const user = authManager.getUser();
                if (!user) return;
                
                try {
                    // å¾Supabaseè¼‰å…¥ä¸Šæ¬¡è¨˜éŒ„
                    if (supabaseClient) {
                        const { data, error } = await supabaseClient
                            .from('weight_records')
                            .select('weight, fat_rate, muscle_mass')
                            .eq('user_id', user.id)
                            .order('created_at', { ascending: false })
                            .limit(1)
                            .single();
                        
                        if (!error && data) {
                            weightValue.value = data.weight || 65.3;
                            fatValue.value = data.fat_rate || 41.3;
                            muscleValue.value = data.muscle_mass || 20.1;
                            return;
                        }
                    }
                } catch (error) {
                    console.error('è¼‰å…¥Supabaseæ•¸æ“šéŒ¯èª¤:', error);
                }
                
                // è¼‰å…¥æœ¬åœ°æ•¸æ“š
                const lastData = localStorage.getItem('lastFitnessData');
                if (lastData) {
                    try {
                        const data = JSON.parse(lastData);
                        weightValue.value = data.weight || 65.3;
                        fatValue.value = data.fat_rate || 41.3;
                        muscleValue.value = data.muscle_mass || 20.1;
                    } catch (e) {
                        console.error('è§£ææœ¬åœ°æ•¸æ“šéŒ¯èª¤:', e);
                    }
                }
            }
            
            // è¨­å®šäº‹ä»¶ç›£è½å™¨
            function setupEventListeners() {
                // ç™»å…¥ç›¸é—œæŒ‰éˆ•
                loginBtn.addEventListener('click', handleLogin);
                signupBtn.addEventListener('click', handleSignup);
                logoutBtn.addEventListener('click', handleLogout);
                logoutMenuBtn.addEventListener('click', handleLogout);
                
                // ç”¨æˆ¶èœå–®æŒ‰éˆ•
                personalSettingsBtn.addEventListener('click', openPersonalSettings);
                pointsRulesBtn.addEventListener('click', openPointsRules);
                scheduleBtn.addEventListener('click', openSchedule);
                
                // å€‹äººè¨­å®šæ¨¡æ…‹æ¡†æŒ‰éˆ•
                closeSettingsModal.addEventListener('click', closePersonalSettings);
                saveProfileBtn.addEventListener('click', saveUserProfile);
                
                // é ­åƒæ–‡ä»¶é¸æ“‡
                avatarFile.addEventListener('change', previewAvatar);
                
                // åŠ æ¸›æŒ‰éˆ•äº‹ä»¶
                document.querySelectorAll('.control-btn').forEach(btn => {
                    btn.addEventListener('click', handleButtonClick);
                    btn.addEventListener('touchstart', handleTouchStart);
                    btn.addEventListener('touchend', handleTouchEnd);
                    btn.addEventListener('touchcancel', handleTouchEnd);
                });
                
                // æäº¤æŒ‰éˆ•äº‹ä»¶
                submitBtn.addEventListener('click', saveDailyData);
                
                // æ»‘å‹•æ‰‹å‹¢èª¿æ•´æ•¸å€¼
                setupSwipeGestures();
                
                // ç”¨æˆ¶é ­åƒé»æ“Šäº‹ä»¶
                userAvatarBtn.addEventListener('click', toggleUserMenu);
                
                // é»æ“Šå…¶ä»–åœ°æ–¹é—œé–‰ä¸‹æ‹‰èœå–®
                document.addEventListener('click', function(event) {
                    if (!userAvatarBtn.contains(event.target) && !userMenuDropdown.contains(event.target)) {
                        userMenuDropdown.classList.remove('show');
                    }
                    
                    // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰æ¨¡æ…‹æ¡†
                    if (event.target === personalSettingsModal) {
                        closePersonalSettings();
                    }
                });
                
                // Enteréµç™»å…¥åŠŸèƒ½
                document.getElementById('email').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') handleLogin();
                });
                
                document.getElementById('password').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') handleLogin();
                });
                
                // Escapeéµé—œé–‰æ¨¡æ…‹æ¡†
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closePersonalSettings();
                    }
                });
            }
            
            // åˆ‡æ›ç”¨æˆ¶èœå–®
            function toggleUserMenu(event) {
                event.stopPropagation();
                userMenuDropdown.classList.toggle('show');
            }
            
            // æ‰“é–‹å€‹äººè¨­å®š
            function openPersonalSettings() {
                userMenuDropdown.classList.remove('show');
                personalSettingsModal.classList.add('show');
                
                // è¼‰å…¥ç›®å‰çš„è¨­å®š
                loadUserProfile();
            }
            
            // é—œé–‰å€‹äººè¨­å®š
            function closePersonalSettings() {
                personalSettingsModal.classList.remove('show');
            }
            
            // é è¦½é ­åƒ
            function previewAvatar() {
                const file = avatarFile.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        avatarImg.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            // å„²å­˜ä½¿ç”¨è€…è¨­å®š
            function saveUserProfile() {
                const profile = {
                    fullName: fullNameInput.value.trim(),
                    role: roleSelect.value,
                    plan: planSelect.value,
                    teamId: teamIdInput.value.trim(),
                    avatarUrl: avatarImg.src,
                    updatedAt: new Date().toISOString()
                };
                
                // å„²å­˜è¨­å®š
                authManager.saveUserProfile(profile);
                
                // æ›´æ–°ä½¿ç”¨è€…åç¨±é¡¯ç¤º
                const user = authManager.getUser();
                if (user && profile.fullName) {
                    user.name = profile.fullName;
                    authManager.updateUser(user);
                    welcomeMessage.textContent = `æ­¡è¿ï¼Œ${profile.fullName}`;
                }
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                statusMsg.textContent = "å€‹äººè¨­å®šå·²å„²å­˜ï¼";
                statusMsg.className = "status-msg success";
                
                setTimeout(() => {
                    statusMsg.textContent = "";
                    statusMsg.className = "status-msg";
                }, 2000);
                
                // é—œé–‰æ¨¡æ…‹æ¡†
                closePersonalSettings();
            }
            
            // è™•ç†æŒ‰éˆ•é»æ“Š
            function handleButtonClick(e) {
                e.preventDefault();
                const type = this.getAttribute('data-type');
                const change = parseFloat(this.getAttribute('data-change'));
                adjustValue(type, change);
            }
            
            // è™•ç†è§¸æ§é–‹å§‹
            let longPressTimer = null;
            let longPressInterval = null;
            
            function handleTouchStart(e) {
                e.preventDefault();
                const type = this.getAttribute('data-type');
                const change = parseFloat(this.getAttribute('data-change'));
                
                adjustValue(type, change);
                
                longPressTimer = setTimeout(() => {
                    longPressInterval = setInterval(() => {
                        adjustValue(type, change);
                    }, 100);
                }, 500);
            }
            
            function handleTouchEnd(e) {
                e.preventDefault();
                clearTimeout(longPressTimer);
                clearInterval(longPressInterval);
            }
            
            // è¨­å®šæ»‘å‹•æ‰‹å‹¢
            function setupSwipeGestures() {
                let touchStartX = 0;
                
                document.querySelectorAll('.input-box').forEach(box => {
                    box.addEventListener('touchstart', function(e) {
                        const touch = e.touches[0];
                        touchStartX = touch.clientX;
                        this.style.transform = 'translateY(2px)';
                    });
                    
                    box.addEventListener('touchmove', function(e) {
                        e.preventDefault();
                        const touch = e.touches[0];
                        const deltaX = touch.clientX - touchStartX;
                        
                        if (Math.abs(deltaX) > 20) {
                            const type = this.getAttribute('data-type');
                            const change = deltaX > 0 ? 0.1 : -0.1;
                            adjustValue(type, change);
                            touchStartX = touch.clientX;
                        }
                    });
                    
                    box.addEventListener('touchend', function() {
                        this.style.transform = '';
                    });
                });
            }
            
            // èª¿æ•´æ•¸å€¼
            function adjustValue(type, change) {
                if (isSubmitted) return;
                
                let element, currentValue, minValue, maxValue;
                
                switch(type) {
                    case 'weight':
                        element = weightValue;
                        currentValue = parseFloat(element.value);
                        minValue = 30; maxValue = 200;
                        break;
                    case 'fat':
                        element = fatValue;
                        currentValue = parseFloat(element.value);
                        minValue = 5; maxValue = 60;
                        break;
                    case 'muscle':
                        element = muscleValue;
                        currentValue = parseFloat(element.value);
                        minValue = 10; maxValue = 100;
                        break;
                    default:
                        return;
                }
                
                let newValue = currentValue + change;
                newValue = Math.max(minValue, Math.min(maxValue, newValue));
                element.value = newValue.toFixed(1);
                
                // è¦–è¦ºåé¥‹
                const box = element.closest('.input-box');
                box.classList.add('shake');
                setTimeout(() => box.classList.remove('shake'), 300);
            }
            
            // è™•ç†ç™»å…¥
            async function handleLogin() {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                // æ¸…é™¤ä¹‹å‰çš„éŒ¯èª¤è¨Šæ¯
                clearErrors();
                
                // åŸºæœ¬é©—è­‰
                let hasError = false;
                
                if (!email) {
                    emailError.textContent = 'è«‹è¼¸å…¥é›»å­éƒµä»¶';
                    emailError.classList.add('show');
                    hasError = true;
                } else if (!authManager.validateEmail(email)) {
                    emailError.textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶';
                    emailError.classList.add('show');
                    hasError = true;
                }
                
                if (!password) {
                    passwordError.textContent = 'è«‹è¼¸å…¥å¯†ç¢¼';
                    passwordError.classList.add('show');
                    hasError = true;
                } else if (password.length < 6) {
                    passwordError.textContent = 'å¯†ç¢¼å¿…é ˆè‡³å°‘6å€‹å­—ç¬¦';
                    passwordError.classList.add('show');
                    hasError = true;
                }
                
                if (hasError) return;
                
                try {
                    statusMsg.textContent = "ç™»å…¥ä¸­...";
                    statusMsg.className = "status-msg warning";
                    
                    const user = await authManager.login(email, password);
                    await showAppSection();
                    
                    statusMsg.textContent = "ç™»å…¥æˆåŠŸï¼";
                    statusMsg.className = "status-msg success";
                    
                    setTimeout(() => {
                        statusMsg.textContent = "";
                        statusMsg.className = "status-msg";
                    }, 2000);
                } catch (error) {
                    console.error('ç™»å…¥éŒ¯èª¤:', error);
                    statusMsg.textContent = error.message || "ç™»å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
                    statusMsg.className = "status-msg error";
                    
                    // é¡¯ç¤ºè©³ç´°éŒ¯èª¤è¨Šæ¯
                    if (error.message.includes('Supabase')) {
                        statusMsg.innerHTML = `
                            ç™»å…¥å¤±æ•—ï¼š<br>
                            1. è«‹æª¢æŸ¥æ‚¨çš„Supabaseé…ç½®<br>
                            2. ç¢ºä¿å·²æ­£ç¢ºè¨­ç½®URLå’ŒåŒ¿åå¯†é‘°<br>
                            3. æˆ–ä½¿ç”¨æœ¬åœ°æ¨¡å¼ï¼ˆä»»ä½•é›»å­éƒµä»¶+å¯†ç¢¼å³å¯ï¼‰
                        `;
                    }
                }
            }
            
            // è™•ç†è¨»å†Š
            async function handleSignup() {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                // æ¸…é™¤ä¹‹å‰çš„éŒ¯èª¤è¨Šæ¯
                clearErrors();
                
                // åŸºæœ¬é©—è­‰
                let hasError = false;
                
                if (!email) {
                    emailError.textContent = 'è«‹è¼¸å…¥é›»å­éƒµä»¶';
                    emailError.classList.add('show');
                    hasError = true;
                } else if (!authManager.validateEmail(email)) {
                    emailError.textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶';
                    emailError.classList.add('show');
                    hasError = true;
                }
                
                if (!password) {
                    passwordError.textContent = 'è«‹è¼¸å…¥å¯†ç¢¼';
                    passwordError.classList.add('show');
                    hasError = true;
                } else if (password.length < 6) {
                    passwordError.textContent = 'å¯†ç¢¼å¿…é ˆè‡³å°‘6å€‹å­—ç¬¦';
                    passwordError.classList.add('show');
                    hasError = true;
                }
                
                if (hasError) return;
                
                try {
                    statusMsg.textContent = "è¨»å†Šä¸­...";
                    statusMsg.className = "status-msg warning";
                    
                    const user = await authManager.signup(email, password);
                    await showAppSection();
                    
                    statusMsg.textContent = "è¨»å†ŠæˆåŠŸï¼æ­¡è¿åŠ å…¥é¦¬æ‹‰æ¾å¥èº«è¿½è¹¤ã€‚";
                    statusMsg.className = "status-msg success";
                    
                    setTimeout(() => {
                        statusMsg.textContent = "";
                        statusMsg.className = "status-msg";
                    }, 2000);
                } catch (error) {
                    console.error('è¨»å†ŠéŒ¯èª¤:', error);
                    statusMsg.textContent = error.message || "è¨»å†Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";
                    statusMsg.className = "status-msg error";
                }
            }
            
            // ç™»å‡º
            function handleLogout() {
                if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                    authManager.logout();
                    showAuthSection();
                    
                    // æ¸…é™¤è¼¸å…¥æ¬„ä½
                    document.getElementById('email').value = '';
                    document.getElementById('password').value = '';
                    
                    // é—œé–‰ä¸‹æ‹‰èœå–®
                    userMenuDropdown.classList.remove('show');
                }
            }
            
            // æ›´æ–°å€’æ•¸è¨ˆæ™‚
            function updateCountdown() {
                const now = new Date();
                const endOfDay = new Date();
                endOfDay.setHours(23, 59, 59, 999);
                
                const timeLeft = endOfDay - now;
                
                if (timeLeft <= 0) {
                    countdownTimer.textContent = "00:00:00";
                    clearInterval(countdownInterval);
                    return;
                }
                
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                countdownTimer.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // æª¢æŸ¥ä»Šå¤©æ˜¯å¦å·²æäº¤
            async function checkTodaySubmission() {
                const user = authManager.getUser();
                if (!user) return;
                
                const today = new Date().toISOString().split('T')[0];
                
                try {
                    if (supabaseClient) {
                        const { data, error } = await supabaseClient
                            .from('weight_records')
                            .select('id')
                            .eq('user_id', user.id)
                            .gte('created_at', `${today}T00:00:00`)
                            .lte('created_at', `${today}T23:59:59`)
                            .limit(1);
                        
                        if (!error && data && data.length > 0) {
                            lockSubmission();
                            statusMsg.textContent = "æ‚¨ä»Šå¤©å·²ç¶“å ±åˆ°éäº†ï¼Œå¦‚éœ€ä¿®æ”¹è«‹è¯çµ¡ç®¡ç†å“¡";
                            statusMsg.className = "status-msg warning";
                            return;
                        }
                    }
                } catch (error) {
                    console.error('æª¢æŸ¥æäº¤ç‹€æ…‹éŒ¯èª¤:', error);
                }
                
                // æœ¬åœ°æª¢æŸ¥
                const lastDate = localStorage.getItem('lastSubmissionDate');
                const todayStr = new Date().toDateString();
                
                if (lastDate === todayStr) {
                    lockSubmission();
                    statusMsg.textContent = "æ‚¨ä»Šå¤©å·²ç¶“å ±åˆ°éäº†ï¼Œå¦‚éœ€ä¿®æ”¹è«‹è¯çµ¡ç®¡ç†å“¡";
                    statusMsg.className = "status-msg warning";
                }
            }
            
            // é–å®šæäº¤ç‹€æ…‹
            function lockSubmission() {
                isSubmitted = true;
                document.querySelectorAll('.input-box').forEach(box => {
                    box.classList.add('locked');
                });
                submitBtn.disabled = true;
                submitBtn.textContent = "ä»Šæ—¥å·²å ±åˆ°";
            }
            
            // å„²å­˜æ¯æ—¥æ•¸æ“šåˆ°Supabase
            async function saveDailyData() {
                if (isSubmitted) return;
                
                const user = authManager.getUser();
                if (!user) {
                    statusMsg.textContent = "è«‹å…ˆç™»å…¥";
                    statusMsg.className = "status-msg error";
                    return;
                }
                
                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                submitBtn.disabled = true;
                submitBtn.textContent = "æäº¤ä¸­...";
                statusMsg.textContent = "æ­£åœ¨æäº¤æ•¸æ“šåˆ°ä¼ºæœå™¨...";
                statusMsg.className = "status-msg warning";
                
                // æ”¶é›†æ•¸æ“š
                const fitnessData = {
                    user_id: user.id,
                    weight: parseFloat(weightValue.value),
                    fat_rate: parseFloat(fatValue.value),
                    muscle_mass: parseFloat(muscleValue.value),
                    created_at: new Date().toISOString()
                };
                
                try {
                    // å˜—è©¦æ’å…¥æ•¸æ“šåˆ°Supabase
                    if (supabaseClient) {
                        const { data, error } = await supabaseClient
                            .from('weight_records')
                            .insert([fitnessData]);
                        
                        if (error) {
                            console.error('Supabaseæ’å…¥éŒ¯èª¤:', error);
                            throw new Error('Supabaseé€£æ¥å¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜');
                        }
                    } else {
                        throw new Error('Supabaseæœªé…ç½®ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜');
                    }
                    
                    // é–å®šæäº¤ç‹€æ…‹
                    lockSubmission();
                    
                    // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                    statusMsg.textContent = "âœ“ æ•¸æ“šæäº¤æˆåŠŸï¼å·²å„²å­˜åˆ°è³‡æ–™åº«";
                    statusMsg.className = "status-msg success";
                    
                } catch (error) {
                    console.error('æäº¤æ•¸æ“šéŒ¯èª¤:', error);
                    
                    // æœ¬åœ°å„²å­˜å‚™ç”¨
                    try {
                        localStorage.setItem('lastFitnessData', JSON.stringify({
                            weight: fitnessData.weight,
                            fat_rate: fitnessData.fat_rate,
                            muscle_mass: fitnessData.muscle_mass
                        }));
                        
                        localStorage.setItem('lastSubmissionDate', new Date().toDateString());
                        
                        lockSubmission();
                        statusMsg.textContent = "âœ“ æ•¸æ“šå·²å„²å­˜åˆ°æœ¬åœ°ï¼ˆè³‡æ–™åº«é€£æ¥å¤±æ•—ï¼‰";
                        statusMsg.className = "status-msg warning";
                    } catch (localError) {
                        console.error('æœ¬åœ°å„²å­˜å¤±æ•—:', localError);
                        statusMsg.textContent = "âœ— æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–è¯çµ¡ç®¡ç†å“¡";
                        statusMsg.className = "status-msg error";
                        submitBtn.disabled = false;
                        submitBtn.textContent = "é€å‡ºä»Šæ—¥å ±åˆ°";
                    }
                }
            }
            
            // ç©åˆ†è¦å‰‡åŠŸèƒ½
            function openPointsRules() {
                userMenuDropdown.classList.remove('show');
                const rules = `
ç©åˆ†è¦å‰‡èªªæ˜ï¼š
1. æ¯æ—¥æº–æ™‚å ±åˆ°ï¼š+10åˆ†
2. é«”é‡æ¯æ¸›å°‘0.1kgï¼š+1åˆ†
3. é«”è„‚ç‡æ¯æ¸›å°‘0.1%ï¼š+2åˆ†
4. è‚Œè‚‰é‡æ¯å¢åŠ 0.1kgï¼š+3åˆ†
5. é€£çºŒå ±åˆ°7å¤©ï¼š+30åˆ†
6. å®Œæˆæˆ°éšŠä»»å‹™ï¼š+20-100åˆ†

*ç©åˆ†ç”±å‰¯éšŠé•·çµ±ä¸€è¨ˆç®—å’Œç®¡ç†
                `;
                alert(rules);
            }
            
            // æ™‚é–“è¡¨åŠŸèƒ½
            function openSchedule() {
                userMenuDropdown.classList.remove('show');
                const day = authManager.getCurrentDay();
                const schedule = `
æ¯ä¸€å±†é¦¬æ‹‰æ¾æ™‚é–“è¡¨ï¼š
ç¬¬1å±†ï¼š2024å¹´1æœˆ1æ—¥ - 2024å¹´3æœˆ31æ—¥
ç¬¬2å±†ï¼š2024å¹´4æœˆ1æ—¥ - 2024å¹´6æœˆ30æ—¥
ç¬¬3å±†ï¼š2024å¹´7æœˆ1æ—¥ - 2024å¹´9æœˆ30æ—¥
ç¬¬4å±†ï¼š2024å¹´10æœˆ1æ—¥ - 2024å¹´12æœˆ31æ—¥
ç¬¬5å±†ï¼š2025å¹´1æœˆ1æ—¥ - 2025å¹´3æœˆ31æ—¥
ç¬¬6å±†ï¼š2025å¹´4æœˆ1æ—¥ - 2025å¹´6æœˆ30æ—¥
ç¬¬7å±†ï¼š2025å¹´7æœˆ1æ—¥ - 2025å¹´9æœˆ30æ—¥
ç¬¬8å±†ï¼š2025å¹´10æœˆ1æ—¥ - 2025å¹´12æœˆ31æ—¥
ç¬¬9å±†ï¼š2026å¹´1æœˆ1æ—¥ - 2026å¹´3æœˆ31æ—¥
ç¬¬10å±†ï¼š2026å¹´4æœˆ1æ—¥ - 2026å¹´6æœˆ30æ—¥
ç¬¬11å±†ï¼š2026å¹´7æœˆ1æ—¥ - 2026å¹´9æœˆ30æ—¥
ç¬¬12å±†ï¼š2026å¹´10æœˆ1æ—¥ - 2026å¹´12æœˆ31æ—¥

ç›®å‰é€²è¡Œä¸­ï¼šç¬¬${day}å¤©
                `;
                alert(schedule);
            }
        })(); // ç«‹å³åŸ·è¡Œå‡½æ•¸çµæŸ
    </script>
</body>
</html>
