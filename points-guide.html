<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç©åˆ†ç²å–æŒ‡å—</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --warning: #f39c12; --danger: #e74c3c; --bg: #f4f7f6; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background-color: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 25px; padding: 20px; background: white; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        h1 { color: #2c3e50; margin: 0; font-size: 28px; }
        .back-btn { position: fixed; top: 20px; left: 20px; background: white; color: var(--primary); border: 2px solid var(--primary); padding: 10px 20px; border-radius: 50px; cursor: pointer; font-weight: bold; z-index: 100; }
        .card { background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .card-title { font-size: 18px; font-weight: bold; color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .points-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #f0f0f0; }
        .points-item:last-child { border-bottom: none; }
        .points-icon { font-size: 24px; margin-right: 15px; min-width: 40px; }
        .points-details { flex: 1; }
        .points-title { font-weight: bold; color: #2c3e50; font-size: 16px; }
        .points-desc { color: #5d6d7e; font-size: 14px; margin-top: 5px; }
        .points-value { font-size: 20px; font-weight: bold; color: var(--success); min-width: 60px; text-align: right; }
        .section-title { font-size: 20px; color: #2c3e50; margin: 30px 0 15px; }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; margin-left: 8px; }
        .badge-daily { background: #e8f4fc; color: var(--primary); }
        .badge-special { background: #f0e8fc; color: #9b59b6; }
        .badge-bonus { background: #fff3cd; color: #856404; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 20px; text-align: center; }
        .stat-value { font-size: 32px; font-weight: bold; margin: 10px 0; }
        .stat-label { font-size: 14px; opacity: 0.9; }
        .how-to-use { background: #f8f9fa; border-radius: 10px; padding: 15px; margin-top: 20px; }
        .how-to-use-title { font-weight: bold; color: #2c3e50; margin-bottom: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='index.html'">â† è¿”å›</button>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ’° ç©åˆ†ç²å–æŒ‡å—</h1>
            <div style="color: #7f8c8d; margin-top: 8px;">
                äº†è§£å¦‚ä½•ç²å¾—ç©åˆ†ï¼Œæå‡ä½ çš„æ’åï¼
            </div>
        </div>
        
        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">æ¯æ—¥æœ€é«˜ç©åˆ†</div>
                <div class="stat-value">3 åˆ†</div>
                <div style="font-size: 12px;">å¯é€£çºŒç´¯ç©</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="stat-label">æŠ½çåˆ¸å…Œæ›ç‡</div>
                <div class="stat-value">50:1</div>
                <div style="font-size: 12px;">50ç©åˆ†æ›1å¼µ</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="stat-label">ç©åˆ†ç”¨é€”</div>
                <div class="stat-value">3+</div>
                <div style="font-size: 12px;">æŠ½çã€æ’åã€çå‹µ</div>
            </div>
        </div>
        
        <!-- æ¯æ—¥ç©åˆ† -->
        <div class="card">
            <div class="card-title">ğŸ“… æ¯æ—¥å›ºå®šç©åˆ†</div>
            <div style="font-size: 14px; color: #7f8c8d; margin-bottom: 15px;">
                å®Œæˆæ¯æ—¥ä»»å‹™ç²å–ç©åˆ†ï¼Œæœ€å¤šå¯ç²å¾—3åˆ†
            </div>
            
            <div class="points-item">
                <div class="points-icon">âš–ï¸</div>
                <div class="points-details">
                    <div class="points-title">
                        å®Œæˆä¸€åœˆï¼ˆé«”é‡+é£²é£Ÿ+Shake+ç›´æ’­ï¼‰
                        <span class="badge badge-daily">å¿…åš</span>
                    </div>
                    <div class="points-desc">
                        é€£çºŒå®Œæˆé«”é‡è¨˜éŒ„ã€é£²é£Ÿæ‰“å¡ã€ä½¿ç”¨Shakeã€è§€çœ‹ç›´æ’­
                    </div>
                </div>
                <div class="points-value">+1 åˆ†</div>
            </div>
            
            <div class="points-item">
                <div class="points-icon">ğŸ¥¤</div>
                <div class="points-details">
                    <div class="points-title">ä½¿ç”¨ç‡Ÿé¤Šå¥¶æ˜” (Shake)</div>
                    <div class="points-desc">
                        æ¯æ—¥ä½¿ç”¨åº·å¯¶èŠç‡Ÿé¤Šå¥¶æ˜”è‡³å°‘ä¸€æ¬¡
                    </div>
                </div>
                <div class="points-value">+1 åˆ†</div>
            </div>
            
            <div class="points-item">
                <div class="points-icon">ğŸƒ</div>
                <div class="points-details">
                    <div class="points-title">å®Œæˆé‹å‹•ä»»å‹™</div>
                    <div class="points-desc">
                        å®Œæˆç•¶æ—¥æŒ‡å®šé‹å‹•é …ç›®è‡³å°‘30åˆ†é˜
                    </div>
                </div>
                <div class="points-value">+1 åˆ†</div>
            </div>
        </div>
        
        <!-- ç‰¹åˆ¥ç©åˆ† -->
        <div class="card">
            <div class="card-title">ğŸ ç‰¹åˆ¥ä»»å‹™ç©åˆ†</div>
            <div style="font-size: 14px; color: #7f8c8d; margin-bottom: 15px;">
                å®Œæˆç‰¹åˆ¥ä»»å‹™ç²å¾—é¡å¤–çå‹µç©åˆ†
            </div>
            
            <div class="points-item">
                <div class="points-icon">ğŸ‘¥</div>
                <div class="points-details">
                    <div class="points-title">
                        è½‰ä»‹ç´¹æœ‹å‹åƒåŠ é¦¬æ‹‰æ¾
                        <span class="badge badge-special">é«˜é¡çå‹µ</span>
                    </div>
                    <div class="points-desc">
                        ä»‹ç´¹1ä½æœ‹å‹åƒåŠ é¦¬æ‹‰æ¾ä¸¦ä»‹ç´¹ä½¿ç”¨æ…¢è·‘è¨ˆç®—
                    </div>
                </div>
                <div class="points-value">+15 åˆ†</div>
            </div>
            
            <div class="points-item">
                <div class="points-icon">ğŸ“£</div>
                <div class="points-details">
                    <div class="points-title">é‚€è«‹æ–°æœ‹å‹åƒåŠ ç ”è¨æœƒ</div>
                    <div class="points-desc">
                        é‚€è«‹æ–°æœ‹å‹åƒåŠ åœ˜éšŠç ”è¨æœƒæ´»å‹•
                    </div>
                </div>
                <div class="points-value">+2 åˆ†</div>
            </div>
            
            <div class="points-item">
                <div class="points-icon">ğŸ‰</div>
                <div class="points-details">
                    <div class="points-title">æœ‹å‹é¦–æ¬¡åƒåŠ ç ”è¨æœƒ</div>
                    <div class="points-desc">
                        æ‚¨é‚€è«‹çš„æœ‹å‹é¦–æ¬¡åƒåŠ ç ”è¨æœƒ
                    </div>
                </div>
                <div class="points-value">+2 åˆ†</div>
            </div>
            
            <div class="points-item">
                <div class="points-icon">ğŸ“±</div>
                <div class="points-details">
                    <div class="points-title">ç¤¾äº¤åª’é«”åˆ†äº«</div>
                    <div class="points-desc">
                        åœ¨ç¤¾äº¤åª’é«”åˆ†äº«ä½ çš„é¦¬æ‹‰æ¾é€²åº¦æˆ–æˆæœ
                    </div>
                </div>
                <div class="points-value">+1 åˆ†</div>
            </div>
        </div>
        
        <!-- çå‹µç©åˆ† -->
        <div class="card">
            <div class="card-title">ğŸ† é€£çºŒçå‹µç©åˆ†</div>
            <div style="font-size: 14px; color: #7f8c8d; margin-bottom: 15px;">
                é€£çºŒå®Œæˆä»»å‹™ç²å¾—é¡å¤–çå‹µ
            </div>
            
            <div class="points-item">
                <div class="points-icon">ğŸ“…</div>
                <div class="points-details">
                    <div class="points-title">é€£çºŒ7å¤©å®Œæˆä»»å‹™</div>
                    <div class="points-desc">
                        é€£çºŒ7å¤©å®Œæˆæ‰€æœ‰å¿…åšä»»å‹™
                    </div>
                </div>
                <div class="points-value">+5 åˆ†</div>
            </div>
            
            <div class="points-item">
                <div class="points-icon">ğŸ…</div>
                <div class="points-details">
                    <div class="points-title">é€£çºŒ30å¤©å®Œæˆä»»å‹™</div>
                    <div class="points-desc">
                        é€£çºŒ30å¤©å®Œæˆæ‰€æœ‰å¿…åšä»»å‹™
                    </div>
                </div>
                <div class="points-value">+20 åˆ†</div>
            </div>
        </div>
        
        <!-- ç©åˆ†ç”¨é€” -->
        <div class="card">
            <div class="card-title">ğŸ¯ ç©åˆ†ç”¨é€”</div>
            <div class="how-to-use">
                <div class="how-to-use-title">1. å…Œæ›æŠ½çåˆ¸ ğŸŸï¸</div>
                <div style="font-size: 14px; color: #4a5568; margin-bottom: 10px;">
                    â€¢ 50ç©åˆ†å¯å…Œæ›1å¼µæŠ½çåˆ¸<br>
                    â€¢ æŠ½çåˆ¸ç”¨æ–¼ç ”è¨æœƒæŠ½çæ´»å‹•<br>
                    â€¢ çå“åŒ…æ‹¬ï¼šç”¢å“ã€å„ªæƒ åˆ¸ã€ç‰¹åˆ¥ç¦®ç‰©
                </div>
                
                <div class="how-to-use-title">2. æ’è¡Œæ¦œæ’å ğŸ“Š</div>
                <div style="font-size: 14px; color: #4a5568; margin-bottom: 10px;">
                    â€¢ å€‹äººç©åˆ†å½±éŸ¿å€‹äººæ’è¡Œæ¦œæ’å<br>
                    â€¢ åœ˜éšŠç¸½ç©åˆ†å½±éŸ¿åœ˜éšŠæ’è¡Œæ¦œæ’å<br>
                    â€¢ æ¯æœˆæ’åå‰3åæœ‰ç‰¹åˆ¥çå‹µ
                </div>
                
                <div class="how-to-use-title">3. ç‰¹æ®Šçå‹µ ğŸ†</div>
                <div style="font-size: 14px; color: #4a5568;">
                    â€¢ ç©åˆ†é”åˆ°ç‰¹å®šé–€æª»å¯ç²å¾—æˆå°±å¾½ç« <br>
                    â€¢ å¯ç”¨æ–¼å…Œæ›ç‰¹åˆ¥æ´»å‹•åƒèˆ‡è³‡æ ¼<br>
                    â€¢ éƒ¨åˆ†ç”¢å“è³¼è²·å„ªæƒ 
                </div>
            </div>
        </div>
        
        <!-- ç©åˆ†è¨ˆç®—ç¤ºä¾‹ -->
        <div class="card">
            <div class="card-title">ğŸ“ ç©åˆ†è¨ˆç®—ç¤ºä¾‹</div>
            <div style="background: #f8fafc; padding: 15px; border-radius: 10px;">
                <div style="margin-bottom: 10px;">
                    <div style="font-weight: bold; color: #2c3e50;">ç¤ºä¾‹1ï¼šå®Œæˆæ‰€æœ‰æ¯æ—¥ä»»å‹™</div>
                    <div style="font-size: 14px; color: #4a5568; margin-top: 5px;">
                        â€¢ å®Œæˆä¸€åœˆï¼ˆé«”é‡+é£²é£Ÿ+Shake+ç›´æ’­ï¼‰ï¼š+1åˆ†<br>
                        â€¢ ä½¿ç”¨Shakeï¼š+1åˆ†<br>
                        â€¢ å®Œæˆé‹å‹•ï¼š+1åˆ†<br>
                        <strong>ç¸½è¨ˆï¼š3åˆ†/å¤©</strong>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <div style="font-weight: bold; color: #2c3e50;">ç¤ºä¾‹2ï¼šä¸€é€±å®Œç¾è¡¨ç¾</div>
                    <div style="font-size: 14px; color: #4a5568; margin-top: 5px;">
                        â€¢ æ¯æ—¥ä»»å‹™ï¼š3åˆ† Ã— 7å¤© = 21åˆ†<br>
                        â€¢ é€£çºŒ7å¤©çå‹µï¼š+5åˆ†<br>
                        â€¢ ç¤¾äº¤åˆ†äº«ï¼š+1åˆ† Ã— 3æ¬¡ = 3åˆ†<br>
                        <strong>ç¸½è¨ˆï¼š29åˆ†/é€±</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æŸ¥çœ‹ç•¶å‰ç©åˆ† -->
        <div class="card" style="text-align: center; border-left: 5px solid var(--success);">
            <div class="card-title">ğŸ“Š æˆ‘çš„ç©åˆ†ç‹€æ…‹</div>
            <div id="my-points-status" style="font-size: 16px; color: #4a5568;">
                è¼‰å…¥ä¸­...
            </div>
            <button style="margin-top: 15px; background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 10px; cursor: pointer; font-weight: bold;"
                    onclick="window.location.href='index.html'">
                è¿”å›å€‹äººä¸­å¿ƒæŸ¥çœ‹ç©åˆ†
            </button>
        </div>
    </div>

<script>
    // Supabase é…ç½®
    const SUPABASE_URL = 'https://sdloakutxcsbshcqpxwn.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNkbG9ha3V0eGNzYnNoY3FweHduIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMTE4MjYsImV4cCI6MjA4MTY4NzgyNn0.5OBQQAinARnZQ6VSCrPl60NWmcSG-QiFMmVIJRW7g-0';
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    // é é¢è¼‰å…¥
    window.onload = async () => {
        // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        const { data: { session } } = await sb.auth.getSession();
        if (!session) {
            document.getElementById('my-points-status').innerHTML = 
                '<div style="color: var(--danger);">è«‹å…ˆç™»å…¥æŸ¥çœ‹ç©åˆ†ç‹€æ…‹</div>';
            return;
        }
        
        const userId = session.user.id;
        await loadUserPoints(userId);
    };
    
    // è¼‰å…¥ç”¨æˆ¶ç©åˆ†
    async function loadUserPoints(userId) {
        try {
            // ç²å–ç”¨æˆ¶è³‡æ–™
            const { data: profile, error } = await sb
                .from('profiles')
                .select('points, full_name')
                .eq('id', userId)
                .single();
            
            if (error) throw error;
            
            // è¨ˆç®—æŠ½çåˆ¸æ•¸é‡
            const tickets = Math.floor((profile.points || 0) / 50);
            const remainingPoints = (profile.points || 0) % 50;
            
            // ç²å–é€£çºŒå¤©æ•¸
            const { data: streakData } = await sb
                .from('daily_scores')
                .select('date')
                .eq('user_id', userId)
                .eq('weight_recorded', true)
                .eq('shake_used', true)
                .eq('task_completed', true)
                .order('date', { ascending: false });
            
            const streakDays = streakData ? streakData.length : 0;
            
            // æ›´æ–°é¡¯ç¤º
            document.getElementById('my-points-status').innerHTML = `
                <div style="margin-bottom: 10px;">
                    <div style="font-size: 14px; color: #7f8c8d;">ç•¶å‰ç©åˆ†</div>
                    <div style="font-size: 36px; font-weight: bold; color: var(--success); margin: 10px 0;">${profile.points || 0}</div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
                    <div style="text-align: center;">
                        <div style="font-size: 14px; color: #7f8c8d;">æŠ½çåˆ¸</div>
                        <div style="font-size: 24px; font-weight: bold; color: var(--primary);">${tickets} å¼µ</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 14px; color: #7f8c8d;">é€£çºŒå¤©æ•¸</div>
                        <div style="font-size: 24px; font-weight: bold; color: var(--warning);">${streakDays} å¤©</div>
                    </div>
                </div>
                
                <div style="background: #e8f4fc; padding: 10px; border-radius: 8px; margin-top: 10px;">
                    <div style="font-size: 12px; color: #4a5568;">
                        å†ç²å¾— <strong>${50 - remainingPoints}</strong> ç©åˆ†å¯å…Œæ›1å¼µæŠ½çåˆ¸
                    </div>
                </div>
            `;
            
        } catch (error) {
            console.error('è¼‰å…¥ç©åˆ†éŒ¯èª¤:', error);
            document.getElementById('my-points-status').innerHTML = 
                '<div style="color: var(--danger);">è¼‰å…¥ç©åˆ†å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†</div>';
        }
    }
</script>
</body>
</html>
